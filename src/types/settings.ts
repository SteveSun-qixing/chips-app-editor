/**
 * ç¼–è¾‘å¼•æ“è®¾ç½®ç³»ç»Ÿç±»å‹å®šä¹‰
 * @module types/settings
 *
 * è®¾ç½®ç³»ç»Ÿé‡‡ç”¨ã€Œæ³¨å†Œä¸­å¿ƒã€æ¶æ„ï¼Œæ¯ä¸ªè®¾ç½®åˆ†ç±»æ˜¯ä¸€ä¸ªå®Œå…¨è‡ªæ²»çš„æ¨¡å—ï¼Œ
 * åŒ…å«è‡ªå·±çš„æ•°æ® schemaã€é»˜è®¤å€¼ã€é¢æ¿ç»„ä»¶å’Œå˜æ›´å¤„ç†å™¨ã€‚
 *
 * æ ¸å¿ƒç±»å‹ï¼š
 * - SettingsPanelDefinition: é¢æ¿å®šä¹‰ï¼Œæ˜¯æ³¨å†Œä¸­å¿ƒçš„åŸºæœ¬å•å…ƒ
 * - SettingsCategory: èœå•å…ƒæ•°æ®
 * - SettingsChangeEvent: è®¾ç½®å˜æ›´äº‹ä»¶
 *
 * æ–°å¢è®¾ç½®åˆ†ç±»çš„æ­¥éª¤ï¼š
 * 1. å®šä¹‰é¢æ¿ç»„ä»¶ XxxPanel.vue
 * 2. åœ¨ settings-registry.ts ä¸­å£°æ˜ SettingsPanelDefinition
 * 3. å®Œæˆã€‚èœå•è‡ªåŠ¨å‡ºç°ï¼Œæ•°æ®è‡ªåŠ¨ç®¡ç†ã€‚
 */

import type { Component } from 'vue';

// ============================================================
// è®¾ç½®åˆ†ç±»æ ‡è¯†ä¸å…ƒæ•°æ®
// ============================================================

/**
 * è®¾ç½®åˆ†ç±»æ ‡è¯†
 *
 * ä½¿ç”¨ string ç±»å‹ä»¥æ”¯æŒæ— é™æ‰©å±•ã€‚
 * å†…ç½®åˆ†ç±»ä½¿ç”¨å›ºå®šå­—ç¬¦ä¸²ï¼ˆlanguageã€themeã€layoutã€toolsã€fileModeã€aboutï¼‰ã€‚
 */
export type SettingsCategoryId = string;

/**
 * è®¾ç½®åˆ†ç±»èœå•åˆ†ç»„
 *
 * ç”¨äºåœ¨å·¦ä¾§èœå•æ ä¸­è¿›è¡Œè§†è§‰åˆ†ç»„ã€‚
 * åŒä¸€ group çš„åˆ†ç±»ä¹‹é—´æ— åˆ†éš”çº¿ï¼Œä¸åŒ group ä¹‹é—´æ˜¾ç¤ºåˆ†éš”çº¿ã€‚
 */
export type SettingsCategoryGroup = string;

/**
 * è®¾ç½®åˆ†ç±»å…ƒæ•°æ®
 *
 * æè¿°ä¸€ä¸ªè®¾ç½®åˆ†ç±»åœ¨èœå•ä¸­çš„æ˜¾ç¤ºä¿¡æ¯ã€‚
 */
export interface SettingsCategory {
  /** åˆ†ç±»å”¯ä¸€æ ‡è¯† */
  id: SettingsCategoryId;
  /** åˆ†ç±»åç§°çš„å¤šè¯­è¨€ keyï¼ˆé€šè¿‡ t() å‡½æ•°è·å–æ˜¾ç¤ºæ–‡æœ¬ï¼‰ */
  labelKey: string;
  /** åˆ†ç±»å›¾æ ‡ï¼ˆemoji æˆ–å›¾æ ‡æ ‡è¯†ï¼‰ */
  icon?: string;
  /** æ’åºæƒé‡ï¼Œè¶Šå°è¶Šé å‰ */
  order: number;
  /** èœå•åˆ†ç»„æ ‡è¯†ï¼ˆå¯é€‰ï¼Œç”¨äºèœå•åˆ†éš”çº¿ï¼‰ */
  group?: SettingsCategoryGroup;
}

// ============================================================
// é¢æ¿å®šä¹‰ â€”â€” æ³¨å†Œä¸­å¿ƒçš„æ ¸å¿ƒç±»å‹
// ============================================================

/**
 * è®¾ç½®é¢æ¿å®šä¹‰
 *
 * æ¯ä¸ªè®¾ç½®åˆ†ç±»çš„å®Œæ•´æè¿°ã€‚é¢æ¿å®šä¹‰æ˜¯æ³¨å†Œä¸­å¿ƒçš„åŸºæœ¬å•å…ƒï¼Œ
 * åŒ…å«è¯¥åˆ†ç±»çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªå®Œå…¨è‡ªæ²»çš„æ¨¡å—ã€‚
 *
 * æ³›å‹å‚æ•° T è¡¨ç¤ºè¯¥åˆ†ç±»çš„è®¾ç½®æ•°æ®ç±»å‹ï¼Œ
 * ä¿è¯ defaultData å’Œ onChange çš„ç±»å‹å®‰å…¨ã€‚
 *
 * @template T - è¯¥åˆ†ç±»çš„è®¾ç½®æ•°æ®ç±»å‹
 *
 * @example
 * ```typescript
 * const themePanel: SettingsPanelDefinition<ThemeSettingsData> = {
 *   category: {
 *     id: 'theme',
 *     labelKey: 'engine_settings.category_theme',
 *     icon: 'ğŸ¨',
 *     order: 200,
 *     group: 'appearance',
 *   },
 *   component: ThemeSettingsPanel,
 *   defaultData: { currentThemeId: 'default-light', followSystem: false },
 *   onChange: async (newData, oldData) => {
 *     await applyThemeToSDK(newData.currentThemeId);
 *   },
 * };
 * ```
 */
export interface SettingsPanelDefinition<T = unknown> {
  /** åˆ†ç±»å…ƒæ•°æ®ï¼ˆèœå•æ˜¾ç¤ºç”¨ï¼‰ */
  category: SettingsCategory;
  /** é¢æ¿ Vue ç»„ä»¶ */
  component: Component;
  /** è¯¥åˆ†ç±»çš„é»˜è®¤è®¾ç½®æ•°æ® */
  defaultData: T;
  /**
   * è®¾ç½®å˜æ›´å¤„ç†å™¨ï¼ˆå¯é€‰ï¼‰
   *
   * å½“è¯¥åˆ†ç±»çš„æ•°æ®é€šè¿‡ Store æ›´æ–°æ—¶è‡ªåŠ¨è°ƒç”¨ã€‚
   * ç”¨äºæ‰§è¡Œå‰¯ä½œç”¨ï¼Œå¦‚åˆ‡æ¢ä¸»é¢˜è°ƒç”¨ SDK.ThemeManagerã€
   * åˆ‡æ¢è¯­è¨€è°ƒç”¨ SDK.I18nManager ç­‰ã€‚
   *
   * @param newData - æ›´æ–°åçš„å®Œæ•´æ•°æ®
   * @param oldData - æ›´æ–°å‰çš„å®Œæ•´æ•°æ®
   */
  onChange?(newData: T, oldData: T): void | Promise<void>;
}

// ============================================================
// å„åˆ†ç±»çš„è®¾ç½®æ•°æ®ç±»å‹
// ============================================================

/**
 * è¯­è¨€ä¸æ–‡å­—è®¾ç½®æ•°æ®
 */
export interface LanguageSettingsData {
  /** å½“å‰è¯­è¨€æ ‡è¯†ï¼ˆå¦‚ 'zh-CN'ã€'en-US'ï¼‰ */
  locale: string;
  /** åŸºç¡€å­—å·ï¼ˆpxï¼‰ï¼ŒèŒƒå›´ 12-24 */
  fontSize: number;
  /** å†…å®¹ç¼©æ”¾æ¯”ä¾‹ï¼ŒèŒƒå›´ 0.5-2.0 */
  contentScale: number;
}

/**
 * ä¸»é¢˜è®¾ç½®æ•°æ®
 */
export interface ThemeSettingsData {
  /** å½“å‰æ¿€æ´»çš„ä¸»é¢˜åŒ… IDï¼ˆæ¯ä¸ªä¸»é¢˜åŒ…æ˜¯ç‹¬ç«‹çš„ï¼Œæ—¥é—´å’Œå¤œé—´æ˜¯ä¸åŒçš„ä¸»é¢˜åŒ…ï¼‰ */
  currentThemeId: string;
  /** æ˜¯å¦è·Ÿéšç³»ç»Ÿä¸»é¢˜åå¥½ï¼ˆè‡ªåŠ¨åœ¨äº®è‰²/æš—è‰²ä¸»é¢˜åŒ…ä¹‹é—´åˆ‡æ¢ï¼‰ */
  followSystem: boolean;
  /** å·²å®‰è£…çš„ä¸»é¢˜åŒ… ID åˆ—è¡¨ */
  installedThemeIds: string[];
}

/**
 * å¼•æ“æ¨¡å¼ï¼ˆå¸ƒå±€ï¼‰è®¾ç½®æ•°æ®
 */
export interface LayoutSettingsData {
  /** å½“å‰å¸ƒå±€æ¨¡å¼ */
  currentLayout: string;
}

/**
 * å·¥å…·ç®¡ç†è®¾ç½®æ•°æ®
 *
 * æ³¨æ„ï¼šå·¥å…·çš„å®é™…çŠ¶æ€ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰ç”± SDK.PluginManager ç®¡ç†ï¼Œ
 * æ­¤å¤„åªå­˜å‚¨ç”¨æˆ·åå¥½å’ŒæŒä¹…åŒ–ç›¸å…³çš„æ•°æ®ã€‚
 */
export interface ToolsSettingsData {
  /** ç”¨æˆ·ç¦ç”¨çš„å·¥å…· ID åˆ—è¡¨ï¼ˆæŒä¹…åŒ–ç”¨ï¼‰ */
  disabledToolIds: string[];
}

/**
 * æ–‡ä»¶ç®¡ç†æ–¹å¼è®¾ç½®æ•°æ®
 */
export interface FileModeSettingsData {
  /** æ–‡ä»¶ç®¡ç†æ–¹å¼ï¼š'link' é“¾æ¥åˆ°æœ¬åœ°æ–‡ä»¶ | 'copy' å¤åˆ¶åˆ°å¡ç‰‡æ–‡ä»¶ä¸­ */
  fileMode: 'link' | 'copy';
}

/**
 * å…³äºé¢æ¿æ•°æ®
 *
 * å…³äºé¢æ¿ä¸ºçº¯å±•ç¤ºï¼Œä¸éœ€è¦å¯ä¿®æ”¹çš„è®¾ç½®æ•°æ®ã€‚
 * æ­¤å¤„å®šä¹‰ç©ºæ¥å£ä½œä¸ºå ä½ï¼Œä¿æŒæ¶æ„ä¸€è‡´æ€§ã€‚
 */
export interface AboutSettingsData {
  /** å ä½å­—æ®µï¼Œå…³äºé¢æ¿æ— å¯ä¿®æ”¹è®¾ç½® */
  readonly _placeholder?: never;
}

// ============================================================
// ä¸»é¢˜é€‰é¡¹ï¼ˆç”¨äº ThemeSettingsPanel çš„ UI å±•ç¤ºï¼‰
// ============================================================

/**
 * ä¸»é¢˜é€‰é¡¹
 *
 * ThemeSettingsPanel ä¸­å±•ç¤ºå¯é€‰ä¸»é¢˜æ—¶ä½¿ç”¨çš„ UI æ•°æ®ç»“æ„ã€‚
 */
export interface ThemeOption {
  /** ä¸»é¢˜åŒ… ID */
  id: string;
  /** ä¸»é¢˜åŒ…åç§° */
  name: string;
  /** ä¸»é¢˜åŒ…ç±»å‹ï¼ˆäº®è‰²/æš—è‰²ä¸»é¢˜åŒ…æ˜¯ç‹¬ç«‹çš„ä¸»é¢˜åŒ…ï¼Œä¸å­˜åœ¨æ¨¡å¼åˆ‡æ¢ï¼‰ */
  type: 'light' | 'dark' | 'auto';
  /** æ˜¯å¦ä¸ºå½“å‰é€‰ä¸­ */
  isActive: boolean;
  /** é¢„è§ˆè‰² - ä¸»è‰² */
  previewPrimary?: string;
  /** é¢„è§ˆè‰² - èƒŒæ™¯è‰² */
  previewBackground?: string;
  /** é¢„è§ˆè‰² - æ–‡å­—è‰² */
  previewText?: string;
}

// ============================================================
// è®¾ç½®å˜æ›´äº‹ä»¶
// ============================================================

/**
 * è®¾ç½®å˜æ›´äº‹ä»¶
 *
 * é€šè¿‡äº‹ä»¶æ€»çº¿å‘å¸ƒï¼Œä¾›å…¶ä»–æ¨¡å—ç›‘å¬è®¾ç½®å˜åŒ–ã€‚
 */
export interface SettingsChangeEvent {
  /** å˜æ›´çš„åˆ†ç±» ID */
  categoryId: SettingsCategoryId;
  /** å˜æ›´å‰çš„æ•°æ® */
  oldData: unknown;
  /** å˜æ›´åçš„æ•°æ® */
  newData: unknown;
}
